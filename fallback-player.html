<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
 <!-- 100% privacy-first analytics -->
     
<script data-collect-dnt="true" async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
<noscript><img src="https://queue.simpleanalyticscdn.com/noscript.gif?collect-dnt=true" alt="" referrerpolicy="no-referrer-when-downgrade"/></noscript>


 <!-- clarity -->
     <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "r4ikpxyih2");
</script>

    <title>Custom Video Player</title>
    <style>
         body, html {
  overflow-y: auto;
}
        /* Nav Bar Styles (Kept from original) */
        .bottom-nav {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: space-around;
            padding: 10px 5px;
            z-index: 1000;
            border-radius: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-mode .bottom-nav {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            transition: all 0.3s;
            padding: 8px 12px;
            border-radius: 20px;
            position: relative;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        .nav-item i {
            font-size: 18px;
            margin-bottom: 3px;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(216, 27, 96, 0.2); /* #d81b60 */
        }

        .nav-item:hover:not(.active) {
            color: var(--text);
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .nav-item:hover:not(.active) {
            background: rgba(0, 0, 0, 0.05);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            background: var(--primary);
            border-radius: 50%;
        }
        
        /* Main Content Styles */
        body {
            overflow-y: scroll;
            min-height: 100vh;
            padding-bottom: 80px; /* Space for nav bar */
            margin: 0;
            background: var(--bg);
            font-family: 'Roboto', sans-serif;
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            transition: background 0.3s ease, color 0.3s ease;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Theme variables */
        :root.dark-mode {
            --primary: #d81b60;
            --bg: #121212;
            --text: #ffffff;
            --text-secondary: #aaaaaa;
            --card-bg: #1e1e1e;
            --border-color: #333333;
            --button-bg: #2a2a2a;
            --button-hover: #3a3a3a;
        }
        :root.light-mode {
            --primary: #d81b60;
            --bg: #ffffff;
            --text: #333333;
            --text-secondary: #666666;
            --card-bg: #f5f5f5;
            --border-color: #cccccc;
            --button-bg: #e0e0e0;
            --button-hover: #d0d0d0;
        }
        
        /* Player Styles */
     /* Fixed player container */
.fixed-player {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 230px; /* Match your player height */
  background: var(--bg);
  z-index: 1000;
}

/* Make iframe fill the player */
.player-wrapper iframe {
  width: 100%;
  height: 100%;
  border: none;
  display: block;
}

/* Scrollable area beneath fixed player */
.scrollable-content {
  margin-top: 230px; /* match fixed player height */
  padding: 15px;
  box-sizing: border-box;
  width: 100%;
  max-width: 100%; /* ✅ ensures it doesn't shrink */
}


        #ytplayer {
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;
            display: block;
            border: none;
        }

        /* New Video Info Styles */
        .video-info-container {

            width: 100%;
            max-width: 900px;
            padding: 15px;
            box-sizing: border-box; 

        }

        .video-title {
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--text);
            margin: 10px 0 5px 0;
        }

        .video-stats {
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 15px;
        }

        .video-stats span {
            margin-right: 10px;
        }

        .video-actions {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.75rem;
            transition: color 0.3s;
        }

        .action-button i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .action-button.like {
            color: var(--primary);
        }

        .action-button:hover {
            color: var(--text);
        }

        /* Channel Info Styles */
        .channel-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .channel-details {
            display: flex;
            align-items: center;
        }

        .channel-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .channel-name {
            font-weight: 500;
            color: var(--text);
            margin-bottom: 3px;
        }

        .channel-subs {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .subscribe-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            font-size: 0.875rem;
        }

        /* Related Videos Styles */
        .related-videos {
            width: 100%;
            max-width: 900px;
            padding: 15px;
            box-sizing: border-box;
        }

        .related-title {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 15px;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .video-card {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .video-card:hover {
            transform: translateY(-5px);
        }

        .video-thumbnail {
            width: 100%;
            height: 140px;
            object-fit: cover;
        }

        .video-details {
            padding: 10px;
        }

        .video-card-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-card-channel {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Styles */
        @media (max-width: 600px) {
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            .video-title {
                font-size: 1rem;
            }
            
            .video-actions {
                justify-content: space-between;
                padding: 0 10px;
            }
        }
        
         // Add to CSS for dislike state
        .action-button.dislike {
            color: var(--primary);
            }
        
        
        .toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #222;
  color: #fff;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 14px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 9999;
}

.toast.show {
  opacity: 1;
}

.ad-dropdown {
  background: #fff;
  border-radius: 10px;
  margin: 12px auto;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 390px;
  padding: 10px 12px;
  position: relative;
}

.ad-dropdown.closed {
  display: none !important;
}

.toggle-ad-btn {
  position: absolute;
  top: 6px;
  right: 10px;
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  color: #333;
}


@media (max-width: 768px) {
  /* Make player use full width and height */
  .fixed-player {
    height: 200px;
  }

  .player-wrapper iframe {
    height: 100%;
    width: 100%;
  }

  /* Space below fixed player */
  .scrollable-content {
    margin-top: 200px;
    padding: 12px;
  }

  /* Video info layout */
  .video-info-container {
    padding: 12px;
    font-size: 14px;
  }

  .video-title {
    font-size: 16px;
    line-height: 1.4;
  }

  .channel-details,
  .video-meta,
  .action-buttons {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .action-buttons button {
    width: 100%;
    padding: 10px;
    font-size: 14px;
  }

  /* Related videos */
  .related-video {
    flex-direction: column;
    gap: 8px;
    margin-bottom: 16px;
  }

  .related-video img {
    width: 100%;
    height: auto;
    border-radius: 8px;
  }

  .related-info {
    font-size: 13px;
  }

  /* Hide large-only elements if any */
  .desktop-only {
    display: none;
  }
}


/* Disable tap highlights on mobile */
* {
  -webkit-tap-highlight-color: transparent;
}

/* Remove focus outlines unless it's for keyboard navigation (accessibility-friendly) */
*:focus {
  outline: none !important;
  box-shadow: none !important;
}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    
   <!-- ✅ NEW: Fixed Player Wrapper -->
<div class="fixed-player">
  <div class="player-container">
    <div class="player-wrapper">
      <iframe id="ytplayer" allowfullscreen></iframe>
    </div>
  </div>
</div>
        
        <!-- Video Info Section -->
        <div class="scrollable-content">
        <div class="video-info-container">
            <h1 class="video-title" id="videoTitle">Loading...</h1>
            <div class="video-stats" id="videoStats">
                <span id="viewCount">...</span>
                <span>•</span>
                <span id="uploadDate">...</span>
            </div>
            
            <div class="video-actions">
                <button class="action-button like" id="likeButton">
                    <i class="fas fa-thumbs-up"></i>
                    <span id="likeCount">...</span>
                </button>
                <button class="action-button" id="dislikeButton">
                    <i class="fas fa-thumbs-down"></i>
                    <span>Dislike</span>
                </button>
                <button class="action-button" id="shareButton">
                    <i class="fas fa-share"></i>
                    <span>Share</span>
                </button>
            </div>
            
            
             <div id="adWrap" style="width: 100%; max-width: 390px; margin: 10px auto;">
  <div id="adDropDown" style="position: relative; background: #1e1e1e; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); padding: 10px;">
    <div id="container-157ab7f6897240672a9dfca48527370d"></div>
  </div>

  <!-- Toggle stays outside -->
  <div style="text-align: right; margin-top: 5px;">
    <button id="toggleAd" style="border: none; background: transparent; font-size: 20px; cursor: pointer; color: #aaa;">
      <i class="fas fa-chevron-up" id="toggleIcon"></i>
    </button>
  </div>
</div>

<script async="async" data-cfasync="false" src="//pubertytechnicallyknowhow.com/157ab7f6897240672a9dfca48527370d/invoke.js"></script>


            <div class="channel-info">
                <div class="channel-details">
                    <img class="channel-avatar" id="channelAvatar" src="" alt="Channel avatar">
                    <div>
                        <div class="channel-name" id="channelName">...</div>
                        <div class="channel-subs" id="channelSubs">...</div>
                    </div>
                </div>
                <button class="subscribe-btn">Subscribe</button>
            </div>
        </div>
        
        
        
        <!-- Related Videos Section -->
        <div class="related-videos">
            <h2 class="related-title">Related Videos</h2>
            <div class="video-grid" id="relatedVideosGrid">
                <!-- Related videos will be inserted here -->
            </div>
        </div>
    </div>
</div>
</div>


    <!-- Navigation Bar (Kept from original) -->
    <div class="bottom-nav">
        <a href="index.html#shortsPage" class="nav-item">
            <i class="fas fa-bolt"></i>
            <span>Shorts</span>
        </a>
        <a href="index.html#explorePage" class="nav-item">
            <i class="fas fa-compass"></i>
            <span>Explore</span>
        </a>
        <a href="index.html#downloadsPage" class="nav-item">
            <i class="fas fa-download"></i>
            <span>Download</span>
        </a>
        <a href="index.html#mePage" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Me</span>
        </a>
    </div>

    <script>
         
         
        // YouTube API Keys
        const API_KEYS = [
            'AIzaSyC_syRSRRxQR1DbtHZzMw9glxcR7My8ly4',
            'AIzaSyABi7KdpAijF9gu09dSefpXJyhjIRY66Eg',
            'AIzaSyAqLty-6vku33b3bpdG5S4oLkyoimdw8TU',
            'AIzaSyBYixFCdGHJ2P512iW010glQRvd93EB6O8',
            'AIzaSyDLW2mkmVVgQcoUpM86VFtOaCegFvyVk_g',
            'AIzaSyDe7rOrqZFH3vIqP9zBtNkQ0Lqz4mBz9BI',
            'AIzaSyDFH66idOZwfx-PfO1AXdsUeCa2gV1kCk4',
            'AIzaSyAlbWmxyzhL2RaNPNlPsANzY7R0JZUj_TU',
            'AIzaSyC4WKW6-m7RlZyu6EctRsN9XjiOz5Z7GWk',
            'AIzaSyDSBtLwMoliYaFW09BnVyzTQADrGABHzKw',
            'AIzaSyCME7E2t1cd8JTwpXIgDSyAwVMja2QHkL8',
            'AIzaSyDdrHGuGB5IKzv6_h7Dkgc60magvKu7YRI',
            'AIzaSyDKnfDW7ujsfEFFGV3kWxsmQg9DDtRAUTM',
            'AIzaSyC7v1svD5oJFa9Sg4aXFvatOMiwKB2EG2A',
            'AIzaSyBS1tt0v9_lLc5HAIAFMkTYbRzVUL27yI0',
            'AIzaSyDRA0Fzdwg5oIIxBBt2NowcrdbeucEa6cc'
        ];
        let currentApiKeyIndex = 0;
            // New variables for like/dislike state
        let isLiked = false;
        let isDisliked = false;
        let isSubscribed = true; // Always subscribed
        

        // Get video ID from URL
        const query = new URLSearchParams(window.location.search);
        const videoId = query.get('v');
        const ytPlayer = document.getElementById('ytplayer');

        // DOM Elements
        const videoTitle = document.getElementById('videoTitle');
        const viewCount = document.getElementById('viewCount');
        const uploadDate = document.getElementById('uploadDate');
        const likeCount = document.getElementById('likeCount');
        const channelAvatar = document.getElementById('channelAvatar');
        const channelName = document.getElementById('channelName');
        const channelSubs = document.getElementById('channelSubs');
        const relatedVideosGrid = document.getElementById('relatedVideosGrid');

        if (videoId) {
            // Load main video
            ytPlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&rel=0&modestbranding=1&controls=1&showinfo=0&playsinline=1`;
            
             // Initialize buttons
            initButtons();
            
            // Fetch video info
            fetchVideoDetails(videoId);
            
            // Fetch related videos
            fetchRelatedVideos(videoId);
        }

        // Format numbers (1000 -> 1K, 1000000 -> 1M)
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Format date (ISO string -> "3 days ago")
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
            
            if (diffInDays === 0) return 'Today';
            if (diffInDays === 1) return 'Yesterday';
            if (diffInDays < 7) return `${diffInDays} days ago`;
            if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;
            if (diffInDays < 365) return `${Math.floor(diffInDays / 30)} months ago`;
            return `${Math.floor(diffInDays / 365)} years ago`;
        }


 // Button initialization
        function initButtons() {
            // Subscribe button always shows "Subscribed"
            const subscribeBtn = document.querySelector('.subscribe-btn');
            subscribeBtn.textContent = 'Subscribed';
            subscribeBtn.style.backgroundColor = 'var(--button-bg)';
            subscribeBtn.style.color = 'var(--text-secondary)';
            
            // Like/Dislike button event listeners
            document.getElementById('likeButton').addEventListener('click', toggleLike);
            document.getElementById('dislikeButton').addEventListener('click', toggleDislike);
            document.getElementById('shareButton').addEventListener('click', fallbackShare);
        }

        // Toggle like function
        function toggleLike() {
            const likeBtn = document.getElementById('likeButton');
            const dislikeBtn = document.getElementById('dislikeButton');
            
            if (isLiked) {
                // Remove like
                likeBtn.classList.remove('like');
                isLiked = false;
                // Update like count visually (decrement)
                const currentLikes = parseInt(likeCount.textContent.replace(/[^0-9]/g, ''));
                likeCount.textContent = formatNumber(currentLikes - 1);
            } else {
                // Add like
                likeBtn.classList.add('like');
                isLiked = true;
                // Update like count visually (increment)
                const currentLikes = parseInt(likeCount.textContent.replace(/[^0-9]/g, ''));
                likeCount.textContent = formatNumber(currentLikes + 1);
                
                // If disliked, remove dislike
                if (isDisliked) {
                    dislikeBtn.classList.remove('dislike');
                    isDisliked = false;
                }
            }
        }

        // Toggle dislike function
        function toggleDislike() {
            const likeBtn = document.getElementById('likeButton');
            const dislikeBtn = document.getElementById('dislikeButton');
            
            if (isDisliked) {
                // Remove dislike
                dislikeBtn.classList.remove('dislike');
                isDisliked = false;
            } else {
                // Add dislike
                dislikeBtn.classList.add('dislike');
                isDisliked = true;
                
                // If liked, remove like
                if (isLiked) {
                    likeBtn.classList.remove('like');
                    isLiked = false;
                    // Update like count visually (decrement)
                    const currentLikes = parseInt(likeCount.textContent.replace(/[^0-9]/g, ''));
                    likeCount.textContent = formatNumber(currentLikes - 1);
                }
            }
        }
        
        
        // Fetch video details from YouTube API
        async function fetchVideoDetails(videoId) {
            try {
                const response = await fetchWithRotation(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoId}&key={API_KEY}`);
                
                if (response.items && response.items.length > 0) {
                    const video = response.items[0];
                    const snippet = video.snippet;
                    const stats = video.statistics;
                    
                    // Update video info
                    videoTitle.textContent = snippet.title;
                    viewCount.textContent = formatNumber(parseInt(stats.viewCount)) + ' views';
                    uploadDate.textContent = formatDate(snippet.publishedAt);
                    likeCount.textContent = formatNumber(parseInt(stats.likeCount));
                    
                    // Update channel info
                    channelName.textContent = snippet.channelTitle;
                    channelAvatar.src = `https://yt3.ggpht.com/ytc/${snippet.channelId}`; // Placeholder, will fetch actual avatar
                    channelSubs.textContent = '... subscribers';
                    
                    // Fetch channel details for avatar and subscriber count
                    fetchChannelDetails(snippet.channelId);
                    
                    // Save to watch history
                    saveToWatchHistory(video);
                }
            } catch (error) {
                console.error('Error fetching video details:', error);
                videoTitle.textContent = 'Video Title Unavailable';
            }
        }

        // Fetch channel details
        async function fetchChannelDetails(channelId) {
    try {
        const response = await fetchWithRotation(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${channelId}&key={API_KEY}`);
        
        if (response.items && response.items.length > 0) {
            const channel = response.items[0];
            channelAvatar.src = channel.snippet.thumbnails.default.url;
            channelSubs.textContent = formatNumber(parseInt(channel.statistics.subscriberCount)) + ' subscribers';
        }
    } catch (error) {
        console.error('Error fetching channel details:', error);
    }
}
        // Fetch related videos
        async function fetchRelatedVideos(videoId) {
        
        if (!videoId || typeof videoId !== "string" || videoId.length < 5) {
  console.error("Invalid videoId for related videos:", videoId);
  return;
}
            try {
                const response = await fetchWithRotation(
  `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&relatedToVideoId=${videoId}&maxResults=10&key={API_KEY}`
);
                
                if (response.items && response.items.length > 0) {
                    displayRelatedVideos(response.items);
                } else {
                    // Fallback to popular videos if no related videos found
                    fetchPopularVideos();
                }
            } catch (error) {
                console.error('Error fetching related videos:', error);
                fetchPopularVideos();
            }
        }


function fallbackShare() {
  // Show your custom modal instead of native share
  const modal = document.getElementById("shareModal");
  modal.style.display = "flex";
}


document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("shareModal");
  const closeBtn = document.getElementById("closeShareModal");
  const copyBtn = document.getElementById("copyShareLink");
  const input = document.getElementById("shareLinkInput");

  // Set the current page URL into the input
  const urlParams = new URLSearchParams(window.location.search);
const videoId = urlParams.get("v");
input.value = `https://tubetrailer.com/watch?v=${videoId}`;

  // Close modal on background or X
  closeBtn.onclick = () => modal.style.display = "none";
  modal.onclick = (e) => {
    if (e.target === modal) modal.style.display = "none";
  };

  // Copy the URL when button clicked
  copyBtn.onclick = () => {
    navigator.clipboard.writeText(input.value)
      .then(() => {
        showToast("Link copied to clipboard!");
        modal.style.display = "none";
      })
      .catch(() => {
        alert("Copy failed. Please copy manually.");
      });
  };
});

        // Fallback to popular videos
        async function fetchPopularVideos() {
            try {
                const response = await fetchWithRotation(
                    `https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&maxResults=10&key=${API_KEYS[currentApiKeyIndex]}`
                );
                
                if (response.items && response.items.length > 0) {
                    displayRelatedVideos(response.items);
                }
            } catch (error) {
                console.error('Error fetching popular videos:', error);
            }
        }

        // Display related videos
        function displayRelatedVideos(videos) {
            relatedVideosGrid.innerHTML = '';
            
            videos.forEach(video => {
                const videoId = video.id.videoId || video.id;
                const snippet = video.snippet;
                
                const videoCard = document.createElement('div');
                videoCard.className = 'video-card';
                videoCard.onclick = () => {
                    window.location.href = `fallback-player.html?v=${videoId}`;
                };
                
                videoCard.innerHTML = `
                    <img src="${snippet.thumbnails.medium.url}" class="video-thumbnail" alt="${snippet.title}">
                    <div class="video-details">
                        <div class="video-card-title">${snippet.title}</div>
                        <div class="video-card-channel">${snippet.channelTitle}</div>
                    </div>
                `;
                
                relatedVideosGrid.appendChild(videoCard);
            });
        }


        // Save to watch history
        function saveToWatchHistory(video) {
            const watched = JSON.parse(localStorage.getItem('watchedVideos')) || [];
            const existingIndex = watched.findIndex(v => v.id === video.id);
            
            if (existingIndex !== -1) {
                watched.splice(existingIndex, 1);
            }
            
            watched.unshift({
                id: video.id,
                title: video.snippet.title,
                thumbnail: `https://img.youtube.com/vi/${video.id}/mqdefault.jpg`,
                url: `fallback-player.html?v=${video.id}`
            });
            
            localStorage.setItem('watchedVideos', JSON.stringify(watched.slice(0, 20)));
        }

        // API request with retry logic
        async function fetchWithRotation(urlTemplate) {
  const totalKeys = API_KEYS.length;
  let attempts = 0;

  for (let i = 0; i < totalKeys; i++) {
    const key = API_KEYS[i];
    const url = urlTemplate.replace('{API_KEY}', key);

    try {
      const response = await fetch(url);
      if (!response.ok) {
        console.warn(`Key ${i} failed: ${response.status}`);
        continue;
      }

      const data = await response.json();
      console.log(`✅ Success with key ${i}`);
      currentApiKeyIndex = i; // Save last working key
      return data;
    } catch (err) {
      console.warn(`Key ${i} network error: ${err.message}`);
    }

    await new Promise(resolve => setTimeout(resolve, 300)); // optional throttle
  }

  throw new Error('❌ All API keys failed.');
}

        // Theme management (from original)
        (function() {
            const savedTheme = localStorage.getItem('themePreference') || 'dark';
            document.documentElement.className = savedTheme === 'light' ? 'light-mode' : 'dark-mode';
        })();

        // Button event listeners
        document.getElementById('likeButton').addEventListener('click', toggleLike);
document.getElementById('dislikeButton').addEventListener('click', toggleDislike);
document.getElementById('shareButton').addEventListener('click', fallbackShare);


// Subscribe button - always shows "Subscribed" and is non-interactive
const subscribeBtn = document.querySelector('.subscribe-btn');
subscribeBtn.textContent = 'Subscribed';
subscribeBtn.style.backgroundColor = 'var(--button-bg)';
subscribeBtn.style.color = 'var(--text-secondary)';
subscribeBtn.style.cursor = 'default';
subscribeBtn.onclick = (e) => {
    e.preventDefault(); // Prevent any default behavior
    return false; // Don't do anything when clicked
};


function updateLikeCount(change) {
    const currentText = likeCount.textContent;
    // Extract number (remove "K" or "M" if present)
    const numText = currentText.replace(/[^0-9.]/g, '');
    let currentValue = parseFloat(numText);
    
    // Handle K/M suffixes
    if (currentText.includes('K')) currentValue *= 1000;
    if (currentText.includes('M')) currentValue *= 1000000;
    
    // Update value
    const newValue = currentValue + change;
    likeCount.textContent = formatNumber(newValue);
}

 
 document.addEventListener("DOMContentLoaded", function () {
    const adDropDown = document.getElementById("adDropDown");
    const toggleIcon = document.getElementById("toggleIcon");

    document.getElementById("toggleAd").addEventListener("click", function () {
      const isVisible = adDropDown.style.display !== "none";

      if (isVisible) {
        adDropDown.style.display = "none";
        toggleIcon.classList.remove("fa-chevron-up");
        toggleIcon.classList.add("fa-chevron-down");
      } else {
        adDropDown.style.display = "block";
        toggleIcon.classList.remove("fa-chevron-down");
        toggleIcon.classList.add("fa-chevron-up");
      }
    });
  });
  
  
    </script>
    <div id="toast" class="toast">Link copied to clipboard!</div>
    
    <!-- Custom Share Modal -->
<div id="shareModal" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.7);
  z-index: 9999;
  align-items: center;
  justify-content: center;
">
  <div style="
    background: #1e1e1e;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 350px;
    text-align: center;
    color: #fff;
    position: relative;
  ">
    <span id="closeShareModal" style="
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 22px;
      cursor: pointer;
    ">&times;</span>

    <p style="margin-bottom: 10px;">Copy this video link:</p>

    <input id="shareLinkInput" type="text" readonly style="
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #2a2a2a;
      color: #fff;
      font-size: 14px;
      text-align: center;
      margin-bottom: 15px;
    " />

    <button id="copyShareLink" style="
      background: var(--primary, #d81b60);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: 500;
      cursor: pointer;
      font-size: 14px;
    ">Copy Link</button>
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchBar = document.getElementById('searchBarContainer');
    const navItems = document.querySelectorAll('.nav-item');

    // Only run if searchBar exists
    if (!searchBar) return;

    navItems.forEach(item => {
      item.addEventListener('click', () => {
        const targetPage = item.getAttribute('href');
        // Only show search bar on explore tab
        if (targetPage && targetPage.includes("#explorePage")) {
          searchBar.style.display = 'flex';
        } else {
          searchBar.style.display = 'none';
        }
      });
    });

    // Hide by default on load unless it's already on explorePage
    const currentHash = window.location.hash;
    if (currentHash !== "#explorePage") {
      searchBar.style.display = 'none';
    } else {
      searchBar.style.display = 'flex';
    }
  });
</script>
<!-- Default Statcounter code for TubeTrailer
http://tubetrailerweb.vercel.app -->
<script type="text/javascript">
var sc_project=13118904; 
var sc_invisible=1; 
var sc_security="0bf9b7d3"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/13118904/0/0bf9b7d3/1/"
alt="Web Analytics"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
<!-- End of Statcounter Code -->
    </body>
</html>
